<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Simulacao fera</title>
		<style type="text/css">
			body{background:#fff; margin:0em 0em; text-align:center;}
			canvas{background:#fff; border:0px solid #666}
		</style>
	</head>
	<body>
		<canvas width="980" height="980"></canvas>
		<script type="text/javascript">
		var ctx = document.querySelector('canvas').getContext('2d');

		var qest = 8;
		var est = [0,0,0,0,0,0,0,0];

		if(qest == 3 | qest == 5 | qest == 8)
			if(qest == 3 | qest == 8)
				est[0] = randomCircle(ctx,'#a80000', 490, 90);
			else
				est[0] = randomCircle(ctx,'#999', 490, 90);
		if(qest == 4 | qest == 6 | qest == 7 | qest == 8)
			est[1] = randomCircle(ctx,'#999', 772.8, 207.1);
		if(qest == 2 | qest == 5 | qest == 6 | qest == 7 | qest == 8)
			est[2] = randomCircle(ctx,'#999', 890, 490);
		if(qest == 3 | qest == 4 | qest == 6 | qest == 7 | qest == 8)
			est[3] = randomCircle(ctx,'#999', 772.8, 772.8);
		if(qest == 5 | qest == 7 | qest == 8)
			est[4] = randomCircle(ctx,'#999', 490, 890);
		if(qest == 3 | qest == 4 | qest == 6 | qest == 7 | qest == 8)
			est[5] = randomCircle(ctx,'#999', 207.1, 772.8);
		if(qest == 2 | qest == 5 | qest == 6 | qest == 7 | qest == 8)
			if(qest == 2)
				est[6] = randomCircle(ctx,'#a80000', 90, 490);
			else
				est[6] = randomCircle(ctx,'#999', 90, 490);
		if(qest == 4 | qest == 5 | qest == 6 | qest == 7 | qest == 8)
			if(qest == 4 | qest == 5 | qest == 6 | qest == 7)
				est[7] = randomCircle(ctx,'#a80000', 207.1, 207.1);
			else
				est[7] = randomCircle(ctx,'#999', 207.1, 207.1);

		ctx.lineWidth = 2;
		ctx.fillStyle = ctx.strokeStyle = '#5ba4ba';
		if(qest == 2){
			est[6].y -= 10;
			est[2].y -= 10;
			arrow(ctx,est[2],est[6],10,1);
			est[6].y += 20;
			est[2].y += 20;
			arrow(ctx,est[6],est[2],10,1);
			est[6].y -= 10;
			est[2].y -= 10;
			//arrow(ctx,est[6],a,10,0);
			//arrow(ctx,dotss(est[6].x-50,est[6].y-50),dotss(est[6].x-50,est[6].y+50),10,0);
			//arrow(ctx,dotss(est[6].x-50,est[6].y+50),est[6],10,1);
		}
		if(qest == 3){
			arrow(ctx,est[5],est[0],10,1);
			arrow(ctx,est[0],est[3],10,1);
			arrow(ctx,est[3],est[5],10,1);
			arrow(ctx,est[5],est[3],10,1);
		}
		if(qest == 8){
			arrow(ctx,est[5],est[0],10,1);
			arrow(ctx,est[5],est[7],10,1);
			arrow(ctx,est[5],est[2],10,1);
			arrow(ctx,est[0],est[3],10,1);
			arrow(ctx,est[3],est[5],10,1);
			arrow(ctx,est[5],est[3],10,1);
			arrow(ctx,est[1],est[0],10,1);
			arrow(ctx,est[6],est[5],10,1);
			arrow(ctx,est[2],est[1],10,1);
			arrow(ctx,est[2],est[7],10,1);
			arrow(ctx,est[7],est[6],10,1);
			arrow(ctx,est[7],est[4],10,1);
			arrow(ctx,est[4],est[1],10,1);
		}
		function arrow(ctx,p1,p2,size,aw){
			ctx.save();

			var points = edges(ctx,p1,p2);
			if (points.length < 2) return 
			p1 = points[0], p2=points[points.length-1];

			// Rotate the context to point along the path
			var dx = p2.x-p1.x, dy=p2.y-p1.y, len=Math.sqrt(dx*dx+dy*dy);
			ctx.translate(p2.x,p2.y);
			ctx.rotate(Math.atan2(dy,dx));

			// line
			ctx.lineCap = 'round';
			ctx.beginPath();
			ctx.moveTo(0,0);
			ctx.lineTo(-len,0);
			ctx.closePath();
			ctx.stroke();

			if(aw == 1){
				// arrowhead
				ctx.beginPath();
				ctx.moveTo(0,0);
				ctx.lineTo(-size,-size);
				ctx.lineTo(-size, size);
				ctx.closePath();
				ctx.fill();
			}
			ctx.restore();
			}

		// Find all transparent/opaque transitions between two points
		// Uses http://en.wikipedia.org/wiki/Bresenham's_line_algorithm
		function edges(ctx,p1,p2,cutoff){
			if (!cutoff) cutoff = 220; // alpha threshold
			var dx = Math.abs(p2.x - p1.x), dy = Math.abs(p2.y - p1.y),
					sx = p2.x > p1.x ? 1 : -1,sy = p2.y > p1.y ? 1 : -1;
			var x0 = Math.min(p1.x,p2.x), y0=Math.min(p1.y,p2.y);
			var pixels = ctx.getImageData(x0,y0,dx+1,dy+1).data;
			var hits=[], over=null;
			for (x=p1.x,y=p1.y,e=dx-dy; x!=p2.x||y!=p2.y;){
				var alpha = pixels[((y-y0)*(dx+1)+x-x0)*4 + 3];
				if (over!=null && (over ? alpha<cutoff : alpha>=cutoff)){
					hits.push({x:x,y:y});
				}
				var e2 = 2*e;
				if (e2 > -dy){ e-=dy; x+=sx}
				if (e2 < dx){ e+=dx; y+=sy}
				over = alpha>=cutoff;
			}
			return hits;
		}

		function randomCircle(ctx,color, x1, y1){
			var x = Math.round(x1), y = Math.round(y1);
			ctx.save();
			ctx.beginPath();
			ctx.arc(x, y, 40, 0, Math.PI * 2, false);
			ctx.fillStyle = color;
			ctx.fill();
			ctx.lineWidth = 2;
			ctx.stroke();
			ctx.restore();
			return {x:x,y:y};
		}
		
		window.location.reload(true);
		</script>
	</body>
</html>
